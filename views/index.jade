extends layout

block content
  .layui-container
    .layui-row
      .layui-col-xs12.layui-col-md12
        br
        h1 #{classId}班青年大学习截图收集——#{task.name}
        br
        hr.layui-bg-red
        .layui-elem-quote 
          p 如果这不是你的班级，可以尝试修改地址栏中的#{classId}
          p 或者，
            a(href="/" style="color:#FF5722") 返回主页
        br
        hr.layui-bg-red
    .layui-row.layui-col-space16 
      .layui-col-xs12.layui-col-md6
        form.layui-form(action='/upload', method='post', enctype='multipart/form-data')
          input(type='hidden',name="classId" value=classId)
          .layui-form-item
            label.layui-form-label 姓名：
            .layui-input-block
              input.layui-input(type="text" name="name" required  lay-verify="required" placeholder="务必输入真实姓名" autocomplete="off")
          .layui-form-item
            label.layui-form-label 信息界面：
            .layui-input-block
              input(type='file', name='info-img' required  lay-verify="required")
          .layui-form-item
            label.layui-form-label 完成界面：
            .layui-input-block
              input(type='file', name='finish-img' required  lay-verify="required")
          .layui-form-item#progress(hidden)
            .layui-input-block
              .layui-progress.layui-progress-big(lay-showPercent="true" lay-filter="demo")
                .layui-progress-bar.layui-bg-blue(lay-percent="0%")
          .layui-form-item#submit-btn
            .layui-input-block
              button.layui-btn(lay-submit) 提交
        br
      .layui-col-xs12.layui-col-md6
        fieldset.layui-elem-field
          legend 更新~~
          .layui-field-box
            p 连续两个月，每次都要催无数遍
            br
            p 每次刚好有且仅有一人不交，这个人，每周还都不一样
            br
            p 我愿称其为《1706班最后一人打死也不交截图定律》
            br
            p 比较好奇他们都是谁，所以临时加更了一个小统计
            br
            p 因为时差问题，有可能不准确（极有可能）
            br
            p 无恶意，仅仅满足我的好奇心
            br
        br
        hr.layui-bg-red
        fieldset.layui-elem-field
          legend 震惊！某三无网站终于修复了这个功能
          .layui-field-box
            p 某同学终于想起了这个上传无响应的bug
            br
            p 加了一个进度条 ⊙▽⊙
            br
            p 应该不会有地球人🌏再把截图上传N+1遍了
            br
            p PS：本来想写个假进度敷衍一下，然后发现，假的和真的代码量差不多 (′▽`〃)
            br
        br
        hr.layui-bg-red
        fieldset.layui-elem-field
          legend 
            del 关于提交后网页没有反应的说明
          .layui-field-box
            p 
              del 部分同学反应，点击提交后网页没有反应
            br
            p 
              del emmm 好吧，这个现象确实存在
            br
            p 
              del 因为服务器在国外，截图上传一般要3-5秒，在此期间，网页不会任何反馈
            br
            p 
              del 所以耐心等待即可，上传成功后会自动跳转
            br
            p 
              del 这个bug会在不久的将来修复，具体时间看心情 (′▽`〃)
            br
        br
        hr.layui-bg-red
        fieldset.layui-elem-field
          legend 有必要吐槽一下
          .layui-field-box
            p 昨天（2020.09.27）加入了新班级。
            br
            p 今天，网站出现了很多奇奇怪怪的名字。
            br
            p 这届网友好优秀啊。
            br
            p 因为我比较懒，除了那个id为【名字越长越牛逼】条目（因为id实在太特么长了，压缩包无法解压），和【111...111】（影响网页显示）外。
            br
            p 其他数据就不删了，留着，鞭尸。
            br
            p 网站的正常功能不受影响，就是团支书下载文件后要手动删除垃圾条目。
            br
        br
        hr.layui-bg-red
        fieldset.layui-elem-field
          legend 一些问答：
          .layui-field-box
            p 页面好捡漏啊
            p ——我，穷，请，打钱，谢谢。
            br
            p 我开多线程转页面会蹦吗？
            p ——会的，但是只要重启得够快，就没人知道我崩了
            br
            p 你好呀
            p ——本来挺好，现在好心情都么得了
            br
            p 名字怎么不验证？
            p ——这。。我也没想到你们辣么优秀
            br
            p 你确定3-5秒就行了嘛
            p ——是的，我确定，但是晚上用网高峰以及人品不好的时候，网速会被拉低。
            br

  script.
    //- layui.use('form', function(){
    //- var form = layui.form;
    
    //- //各种基于事件的操作，下面会有进一步介绍
    //- });

    var element=null;
    layui.use('element', function(){
      element = layui.element;
    });
    $('form').on('submit', function (e) {
        e.preventDefault(); 
        $("#submit-btn").hide();
        $("#progress").show();
        let fd = new FormData(this); 
        $.ajax({
            type: 'POST',
            url: '/upload',
            data: fd,
            //- dataType:'json',
            contentType: false,
            processData: false, 
            xhr: function () { 
                let xhr = new XMLHttpRequest();
                if (xhr.upload) {
                  xhr.upload.addEventListener('progress', jdt, false);
                }
                return xhr; 
            },
            success: function (res) { 
                //- console.log(res);
                $(location).attr('href', '/info/classId/#{classId}');
              },
              beforesend:function(){},
              complete:function(){},  
        })
    })
    function jdt(e){
        //- $('progress').attr('max',e.total); 
        //- $('progress').attr('value',e.loaded);
        element.progress('demo', parseInt(e.loaded*100/e.total)+'%');

    }

